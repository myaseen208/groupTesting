<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>EM Algorithm for Fitting Regression Models to Group Testing Data — glm.gt • groupTesting</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="EM Algorithm for Fitting Regression Models to Group Testing Data — glm.gt"><meta property="og:description" content="This function implements an expectation-maximization (EM) algorithm to fit regression models to group testing data, where pooled responses are related to individual covariates through a link function in the generalized linear model (GLM) family. The EM algorithm, which is outlined in Warasi (2021), finds the maximum likelihood estimate (MLE) for the vector of regression coefficients, beta. The EM algorithm can model pooling data observed from any group testing protocol used in practice, including hierarchical and array testing (Kim et al., 2007)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">groupTesting</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>EM Algorithm for Fitting Regression Models to Group Testing Data</h1>
    
    <div class="hidden name"><code>glm.gt.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function implements an expectation-maximization (EM) algorithm to fit regression models to group testing data, where pooled responses are related to individual covariates through a link function in the generalized linear model (GLM) family. The EM algorithm, which is outlined in Warasi (2021), finds the maximum likelihood estimate (MLE) for the vector of regression coefficients, <strong>beta</strong>. The EM algorithm can model pooling data observed from <strong>any</strong> group testing protocol used in practice, including hierarchical and array testing (Kim et al., 2007).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">glm.gt</span><span class="op">(</span></span>
<span>  <span class="va">beta0</span>,</span>
<span>  <span class="va">gtData</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">g</span>,</span>
<span>  dg <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  d2g <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  grdMethod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"central"</span>, <span class="st">"forward"</span>, <span class="st">"backward"</span><span class="op">)</span>,</span>
<span>  covariance <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nburn <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  ngit <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  tracing <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>beta0</dt>
<dd><p>An initial value for the regression coefficients.</p></dd>


<dt>gtData</dt>
<dd><p>A matrix or data.frame consisting of the pooled test outcomes and other information from a group testing application. Needs to be specified as shown in the example below.</p></dd>


<dt>X</dt>
<dd><p>The design matrix.</p></dd>


<dt>g</dt>
<dd><p>An inverse link function in the GLM family.</p></dd>


<dt>dg</dt>
<dd><p>The first derivate of <code>g</code>. When NULL, a finite-difference approximation will be used.</p></dd>


<dt>d2g</dt>
<dd><p>The second derivate of <code>g</code>. When NULL, a finite-difference approximation will be used.</p></dd>


<dt>grdMethod</dt>
<dd><p>The finite-difference approximation method to be used for <code>dg</code> and <code>d2g</code>. See 'Details'.</p></dd>


<dt>covariance</dt>
<dd><p>When TRUE, the covariance matrix is calculated at the MLE.</p></dd>


<dt>nburn</dt>
<dd><p>The number of initial Gibbs iterates to be discarded.</p></dd>


<dt>ngit</dt>
<dd><p>The number of Gibbs iterates to be used in the E-step after discarding <code>nburn</code> iterates as a burn-in period.</p></dd>


<dt>maxit</dt>
<dd><p>The maximum number of EM steps (iterations) allowed in the EM algorithm.</p></dd>


<dt>tol</dt>
<dd><p>Convergence tolerance used in the EM algorithm.</p></dd>


<dt>tracing</dt>
<dd><p>When TRUE, progress in the EM algorithm is displayed.</p></dd>


<dt>conf.level</dt>
<dd><p>Confidence level to be used for the Wald confidence interval.</p></dd>


<dt>...</dt>
<dd><p>Further arguments to be passed to <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>. See 'Details'.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list with components:</p>
<dl><dt>param</dt>
<dd><p>The MLE of the regression coefficients.</p></dd>

<dt>covariance</dt>
<dd><p>Estimated covariance matrix for the regression coefficients.</p></dd>

<dt>iterUsed</dt>
<dd><p>The number of EM iterations needed for convergence.</p></dd>

<dt>convergence</dt>
<dd><p>0 if the EM algorithm converges successfully and 1 if the iteration limit <code>maxit</code> has been reached.</p></dd>

<dt>summary</dt>
<dd><p>Estimation summary with Wald confidence interval.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p><code>gtData</code> must be specified as follows. Columns 1-5 consist of the pooled test outcomes (0 for negative and 1 for positive), pool sizes, pool-specific sensitivities, pool-specific specificities, and assay identification (ID) numbers, respectively. From column 6 onward, the pool member ID numbers need to be specified. Note that the ID numbers must start with 1 and increase consecutively up to <code>N</code>, the total number of individuals tested. <strong>For smaller pools, incomplete ID numbers must be filled out by -9 or any non-positive numbers</strong> as shown in the example below. The design matrix <code>X</code> consists of invidual covariate information, such as age, sex, and symptoms, of the pool members located in column 6 onward.</p>
<p>|     |  Z  |  psz  |   Se   |   Sp   |  Assay  |  Mem1  |  Mem2  |  Mem3  |  Mem4  |  Mem5  |  Mem6  |
|:---:|:---:|:-----:|:------:|:------:|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|       
| Pool:1   |  1  |   6   |  0.90  |  0.92  |    1    |    1    |    2    |    3    |    4    |    5    |    6    |
| Pool:2   |  0  |   6   |  0.90  |  0.92  |    1    |    7    |    8    |    9    |   10    |    11   |   12    |
| Pool:3   |  1  |   2   |  0.95  |  0.96  |    2    |    1    |    2    |   -9    |   -9    |    -9   |   -9    |
| Pool:4   |  0  |   2   |  0.95  |  0.96  |    2    |    3    |    4    |   -9    |   -9    |    -9   |   -9    |
| Pool:5   |  1  |   2   |  0.95  |  0.96  |    2    |    5    |    6    |   -9    |   -9    |    -9   |   -9    |
| Pool:6   |  0  |   1   |  0.92  |  0.90  |    3    |    1    |   -9    |   -9    |   -9    |    -9   |   -9    |
| Pool:7   |  1  |   1   |  0.92  |  0.90  |    3    |    2    |   -9    |   -9    |   -9    |    -9   |   -9    |
| Pool:8   |  0  |   1   |  0.92  |  0.90  |    3    |    5    |   -9    |   -9    |   -9    |    -9   |   -9    |
| Pool:9   |  0  |   1   |  0.92  |  0.90  |    3    |    6    |   -9    |   -9    |   -9    |    -9   |   -9    |</p>
<p>This is an example of <code>gtData</code>, where 12 individuals are assigned to 2 non-overlapping initial pools and then tested based on the 3-stage hierarchical protocol. The test outcomes, <code>Z</code>, from 9 pools are in column 1. In three stages, different pool sizes (6, 2, and 1), sensitivities, specificities, and assays are used. The ID numbers of the pool members are shown in columns 6-11. The row names and column names are not required. Note that the EM algorithm can accommodate any group testing data including those described in Kim et al. (2007). For individual testing data, the pool size in column 2 is 1 for all pools.</p>
<p><code>X</code> is an \(N\)x\(k\) design matrix, where each column represents a vector of individual covariate values. For an intercept model, the first column values must be 1. The column (covariate) names of X, such as 'age' and 'sex', will be displayed in the estimation summary. When column names are missing (NULL), the names that will be displayed by default are 'Intercept', 'x1', 'x2', and so on.</p> 
<p>The EM algorithm implements a Gibbs sampler to approximate the expectation in the E-step. Under each EM iteration, <code>ngit</code> Gibbs samples are retained for these purposes after discarding the initial <code>nburn</code> samples.</p>
<p><code>g</code> relates the pooled responses Z (column 1 in <code>gtData</code>) to <code>X</code>. <code>dg</code> and <code>d2g</code> can be specified analogously. These characteristics can be obtained from <code><a href="glmLink.html">glmLink</a></code> for the common links: logit, probit, and complementary log-log.</p>
<p><code>grdMethod</code> is used only when dg and d2g are NULL, where a finite-difference approximation is implemented by the function <code>fderiv</code> from the package 'pracma'.</p>
<p>The optimization routine <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code> is used to complete the M-step with the default method 'Nelder-Mead'. The argument ... allows the user to change the default method as well as other arguments in <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>.</p>
<p>The covariance matrix is calculated by an appeal to the missing data principle and the method outlined in Louis (1982).</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Kim HY, Hudgens M, Dreyfuss J, Westreich D, and Pilcher C. (2007). Comparison of Group Testing Algorithms for Case Identification in the Presence of Testing Error. <em>Biometrics</em>, 63:1152-1163.</p>
<p>Louis T. (1982). Finding the Observed Information Matrix when Using the EM algorithm. <em>Journal of the Royal Statistical Society: Series B</em>, 44:226-233.</p>
<p>Vansteelandt S, Goetghebeur E, and Verstraeten T. (2000). Regression Models for Disease Prevalence with Diagnostic Tests on Pools of Serum Samples. <em>Biometrics</em>, 56:1126-1133.</p>
<p>Warasi M. (2021). groupTesting: An R Package for Group Testing Estimation. <em>Communications in Statistics-Simulation and Computation</em>. Published online on Dec 9, 2021.
Available at https://www.tandfonline.com/doi/full/10.1080/03610918.2021.2009867</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="hier.gt.simulation.html">hier.gt.simulation</a></code> and <code><a href="array.gt.simulation.html">array.gt.simulation</a></code> for group testing data simulation, and <code><a href="prop.gt.html">prop.gt</a></code> for estimation of a disease prevalence from group testing data.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">groupTesting</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## To illustrate 'glm.gt', we use data simulated  </span></span></span>
<span class="r-in"><span><span class="co">## by the functions 'hier.gt.simulation' and 'array.gt.simulation'.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Note: The simulated data-structures are consistent  </span></span></span>
<span class="r-in"><span><span class="co">## with the data-structure required for 'gtData'.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 1: MLE from 3-stage hierarchical group testing data.</span></span></span>
<span class="r-in"><span><span class="co">## The data used is simulated by 'hier.gt.simulation'. </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">200</span>              <span class="co"># Sample size</span></span></span>
<span class="r-in"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fl">3</span>                <span class="co"># 3-stage hierarchical testing</span></span></span>
<span class="r-in"><span><span class="va">psz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>       <span class="co"># Pool sizes used in stages 1-3</span></span></span>
<span class="r-in"><span><span class="va">Se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.95</span>,<span class="fl">.95</span>,<span class="fl">.98</span><span class="op">)</span>  <span class="co"># Sensitivities in stages 1-3</span></span></span>
<span class="r-in"><span><span class="va">Sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.95</span>,<span class="fl">.98</span>,<span class="fl">.96</span><span class="op">)</span>  <span class="co"># Specificities in stages 1-3</span></span></span>
<span class="r-in"><span><span class="va">assayID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>   <span class="co"># Assays used in stages 1-3</span></span></span>
<span class="r-in"><span><span class="va">param.t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>  <span class="co"># The TRUE parameter to be estimated</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulating covariates:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, size<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span> <span class="va">X</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="st">"Predictor 1"</span>, <span class="st">"Predictor 2"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Note: Because the 1st column of X is 1, intercept model will be fit.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specifying logit inverse link:</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>  </span></span>
<span class="r-in"><span><span class="va">pReg</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">X</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">param.t</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulating test responses:</span></span></span>
<span class="r-in"><span><span class="va">gtOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="hier.gt.simulation.html">hier.gt.simulation</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">pReg</span>,<span class="va">S</span>,<span class="va">psz</span>,<span class="va">Se</span>,<span class="va">Sp</span>,<span class="va">assayID</span><span class="op">)</span><span class="op">$</span><span class="va">gtData</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>N is not divisible by the initial pool size; a smaller remainder pool is used</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fitting the model (with intercept):</span></span></span>
<span class="r-in"><span><span class="va">param0</span> <span class="op">&lt;-</span> <span class="va">param.t</span> <span class="op">+</span> <span class="fl">0.2</span>   <span class="co"># Initial value</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">glm.gt</span><span class="op">(</span>beta0<span class="op">=</span><span class="va">param0</span>,gtData<span class="op">=</span><span class="va">gtOut</span>,X<span class="op">=</span><span class="va">X</span>,</span></span>
<span class="r-in"><span>              g<span class="op">=</span><span class="va">g</span>,dg<span class="op">=</span><span class="cn">NULL</span>,d2g<span class="op">=</span><span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>              grdMethod<span class="op">=</span><span class="st">"central"</span>,covariance<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>              nburn<span class="op">=</span><span class="fl">2000</span>,ngit<span class="op">=</span><span class="fl">5000</span>,maxit<span class="op">=</span><span class="fl">200</span>,</span></span>
<span class="r-in"><span>              tol<span class="op">=</span><span class="fl">1e-03</span>,tracing<span class="op">=</span><span class="cn">TRUE</span>,conf.level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -2.829455 2.055082 0.7903316 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -2.836381 2.004016 0.6914144 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -2.837917 1.994798 0.680326 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -2.842615 1.997391 0.6788417 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 -2.840753 1.990751 0.6762422 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 -2.839137 1.987036 0.6758376 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 -2.841828 1.98852 0.6756098 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8 -2.839058 1.990964 0.6778675 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 -2.841171 1.992008 0.676713 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 -2.840802 1.992916 0.677176 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note: Because dg and d2g are NULL (i.e., the exact derivatives</span></span></span>
<span class="r-in"><span><span class="co">#       are not given), numerical derivatives are used.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Estimation results:</span></span></span>
<span class="r-in"><span><span class="co"># &gt; res</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># $param</span></span></span>
<span class="r-in"><span><span class="co"># [1] -2.840802  1.992916  0.677176</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># $covariance</span></span></span>
<span class="r-in"><span><span class="co">#            [,1]        [,2]        [,3]</span></span></span>
<span class="r-in"><span><span class="co"># [1,]  0.2134439 -0.10147555 -0.16693776</span></span></span>
<span class="r-in"><span><span class="co"># [2,] -0.1014756  0.16855122  0.02997113</span></span></span>
<span class="r-in"><span><span class="co"># [3,] -0.1669378  0.02997113  0.26324589</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># $iterUsed</span></span></span>
<span class="r-in"><span><span class="co"># [1] 10</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># $convergence</span></span></span>
<span class="r-in"><span><span class="co"># [1] 0</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># $summary</span></span></span>
<span class="r-in"><span><span class="co">#             Estimate Std.Err 95%lower 95%upper</span></span></span>
<span class="r-in"><span><span class="co"># Intercept     -2.841   0.462   -3.746   -1.935</span></span></span>
<span class="r-in"><span><span class="co"># Predictor 1    1.993   0.411    1.188    2.798</span></span></span>
<span class="r-in"><span><span class="co"># Predictor 2    0.677   0.513   -0.328    1.683</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 2: MLE from two-dimensional array testing data.</span></span></span>
<span class="r-in"><span><span class="co">## The data used is simulated by 'array.gt.simulation'. </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">200</span>            <span class="co"># Sample size</span></span></span>
<span class="r-in"><span><span class="va">protocol</span> <span class="op">&lt;-</span> <span class="st">"A2"</span>     <span class="co"># 2-stage array without testing initial master pool</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span>               <span class="co"># Row/column size</span></span></span>
<span class="r-in"><span><span class="va">Se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.95</span><span class="op">)</span>  <span class="co"># Sensitivities</span></span></span>
<span class="r-in"><span><span class="va">Sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.98</span>, <span class="fl">0.98</span><span class="op">)</span>  <span class="co"># Specificities</span></span></span>
<span class="r-in"><span><span class="va">assayID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>   <span class="co"># The same assay in both stages</span></span></span>
<span class="r-in"><span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>   <span class="co"># The TRUE parameter to be estimated</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulating data:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, size<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, <span class="va">x3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Note: Because the 1st column of X is not 1, </span></span></span>
<span class="r-in"><span><span class="co">#       the model without intercept will be fit.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Finding g, dg, and d2g from the function 'glmLink':  </span></span></span>
<span class="r-in"><span><span class="va">res0</span> <span class="op">&lt;-</span> <span class="fu"><a href="glmLink.html">glmLink</a></span><span class="op">(</span>fn.name<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>  </span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">res0</span><span class="op">$</span><span class="va">g</span>            <span class="co"># Logit inverse link g()</span></span></span>
<span class="r-in"><span><span class="va">dg</span> <span class="op">&lt;-</span> <span class="va">res0</span><span class="op">$</span><span class="va">dg</span>          <span class="co"># The exact first derivate of g</span></span></span>
<span class="r-in"><span><span class="va">d2g</span> <span class="op">&lt;-</span> <span class="va">res0</span><span class="op">$</span><span class="va">d2g</span>        <span class="co"># The exact second derivate of g</span></span></span>
<span class="r-in"><span><span class="va">pReg</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">X</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">param</span><span class="op">)</span>   <span class="co"># Individual probabilities</span></span></span>
<span class="r-in"><span><span class="va">gtOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="array.gt.simulation.html">array.gt.simulation</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">pReg</span>,<span class="va">protocol</span>,<span class="va">n</span>,<span class="va">Se</span>,<span class="va">Sp</span>,<span class="va">assayID</span><span class="op">)</span><span class="op">$</span><span class="va">gtData</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fitting the model (without intercept):</span></span></span>
<span class="r-in"><span><span class="va">param0</span> <span class="op">&lt;-</span> <span class="va">param</span> <span class="op">+</span> <span class="fl">0.2</span> </span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">glm.gt</span><span class="op">(</span>beta0<span class="op">=</span><span class="va">param0</span>,gtData<span class="op">=</span><span class="va">gtOut</span>,X<span class="op">=</span><span class="va">X</span>,g<span class="op">=</span><span class="va">g</span>,                  </span></span>
<span class="r-in"><span>              dg<span class="op">=</span><span class="va">dg</span>,d2g<span class="op">=</span><span class="va">d2g</span>,covariance<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>              nburn<span class="op">=</span><span class="fl">2000</span>,ngit<span class="op">=</span><span class="fl">5000</span>,maxit<span class="op">=</span><span class="fl">200</span>,</span></span>
<span class="r-in"><span>              tol<span class="op">=</span><span class="fl">1e-03</span>,tracing<span class="op">=</span><span class="cn">TRUE</span>,conf.level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -4.026026 1.309437 1.144329 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -4.064364 1.323499 1.133333 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -4.066465 1.326077 1.131436 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -4.076635 1.328724 1.136758 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 -4.076688 1.329063 1.135778 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $param</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -4.076688  1.329063  1.135778</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $covariance</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]        [,2]        [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  0.41153794 -0.06167216 -0.16901935</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.06167216  0.20280949  0.01567473</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -0.16901935  0.01567473  0.14752063</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $iterUsed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $summary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std.Err 95%lower 95%upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1   -4.077   0.642   -5.334   -2.819</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2    1.329   0.450    0.446    2.212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x3    1.136   0.384    0.383    1.889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">## Example 3: MLE from non-overlapping initial pooled responses.</span></span></span>
<span class="r-in"><span><span class="co">## The data used is simulated by 'hier.gt.simulation'.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Note: With initial pooled responses, our MLE is equivalent  </span></span></span>
<span class="r-in"><span><span class="co">## to the MLE in Vansteelandt et al. (2000).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span>             <span class="co"># Sample size</span></span></span>
<span class="r-in"><span><span class="va">psz</span> <span class="op">&lt;-</span> <span class="fl">5</span>              <span class="co"># Pool size</span></span></span>
<span class="r-in"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fl">1</span>                <span class="co"># 1-stage testing</span></span></span>
<span class="r-in"><span><span class="va">Se</span> <span class="op">&lt;-</span> <span class="fl">0.95</span>            <span class="co"># Sensitivity</span></span></span>
<span class="r-in"><span><span class="va">Sp</span> <span class="op">&lt;-</span> <span class="fl">0.99</span>            <span class="co"># Specificity</span></span></span>
<span class="r-in"><span><span class="va">assayID</span> <span class="op">&lt;-</span> <span class="fl">1</span>          <span class="co"># Assay used for all pools</span></span></span>
<span class="r-in"><span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>    <span class="co"># The TRUE parameter to be estimated</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulating data:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, size<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Finding g, dg, and d2g by the function 'glmLink':  </span></span></span>
<span class="r-in"><span><span class="va">res0</span> <span class="op">&lt;-</span> <span class="fu"><a href="glmLink.html">glmLink</a></span><span class="op">(</span>fn.name<span class="op">=</span><span class="st">"probit"</span><span class="op">)</span>  <span class="co"># Probit link</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">res0</span><span class="op">$</span><span class="va">g</span></span></span>
<span class="r-in"><span><span class="va">dg</span> <span class="op">&lt;-</span> <span class="va">res0</span><span class="op">$</span><span class="va">dg</span></span></span>
<span class="r-in"><span><span class="va">d2g</span> <span class="op">&lt;-</span> <span class="va">res0</span><span class="op">$</span><span class="va">d2g</span></span></span>
<span class="r-in"><span><span class="va">pReg</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">X</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">param</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gtOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="hier.gt.simulation.html">hier.gt.simulation</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">pReg</span>,<span class="va">S</span>,<span class="va">psz</span>,<span class="va">Se</span>,<span class="va">Sp</span>,<span class="va">assayID</span><span class="op">)</span><span class="op">$</span><span class="va">gtData</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fitting the model:</span></span></span>
<span class="r-in"><span><span class="va">param0</span> <span class="op">&lt;-</span> <span class="va">param</span> <span class="op">+</span> <span class="fl">0.2</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">glm.gt</span><span class="op">(</span>beta0<span class="op">=</span><span class="va">param0</span>,gtData<span class="op">=</span><span class="va">gtOut</span>,X<span class="op">=</span><span class="va">X</span>,g<span class="op">=</span><span class="va">g</span>,                 </span></span>
<span class="r-in"><span>                 dg<span class="op">=</span><span class="va">dg</span>,d2g<span class="op">=</span><span class="va">d2g</span>,covariance<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                 nburn<span class="op">=</span><span class="fl">2000</span>,ngit<span class="op">=</span><span class="fl">5000</span>,maxit<span class="op">=</span><span class="fl">200</span>,</span></span>
<span class="r-in"><span>                 tol<span class="op">=</span><span class="fl">1e-03</span>,tracing<span class="op">=</span><span class="cn">TRUE</span>,conf.level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -2.803943 1.944176 1.052621 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -2.793933 1.813359 0.9879339 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -2.779758 1.756712 0.9623147 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -2.770572 1.729779 0.9593273 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 -2.757258 1.712989 0.9514586 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 -2.751576 1.704556 0.9513321 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 -2.750417 1.700497 0.9539637 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8 -2.747167 1.698961 0.9512011 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 -2.742555 1.69311 0.9507849 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 -2.738423 1.6915 0.9485044 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 -2.736061 1.691703 0.9445282 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 -2.735381 1.69184 0.9438588 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $param</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -2.7353811  1.6918399  0.9438588</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $covariance</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]        [,2]        [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  0.11493986 -0.06633566 -0.07856678</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.06633566  0.06540346  0.02279571</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -0.07856678  0.02279571  0.08619724</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $iterUsed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $summary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std.Err 95%lower 95%upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      -2.735   0.339   -3.400   -2.071</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1    1.692   0.256    1.191    2.193</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2    0.944   0.294    0.368    1.519</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 4: MLE from individual (one-by-one) testing data.</span></span></span>
<span class="r-in"><span><span class="co">## The data used is simulated by 'hier.gt.simulation'.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span>             <span class="co"># Sample size</span></span></span>
<span class="r-in"><span><span class="va">psz</span> <span class="op">&lt;-</span> <span class="fl">1</span>              <span class="co"># Pool size 1 (i.e., individual testing)</span></span></span>
<span class="r-in"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fl">1</span>                <span class="co"># 1-stage testing</span></span></span>
<span class="r-in"><span><span class="va">Se</span> <span class="op">&lt;-</span> <span class="fl">0.95</span>            <span class="co"># Sensitivity</span></span></span>
<span class="r-in"><span><span class="va">Sp</span> <span class="op">&lt;-</span> <span class="fl">0.99</span>            <span class="co"># Specificity</span></span></span>
<span class="r-in"><span><span class="va">assayID</span> <span class="op">&lt;-</span> <span class="fl">1</span>          <span class="co"># Assay used for all pools</span></span></span>
<span class="r-in"><span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>    <span class="co"># The TRUE parameter to be estimated</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulating data:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, size<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>  <span class="co"># Inverse logit </span></span></span>
<span class="r-in"><span><span class="va">pReg</span> <span class="op">&lt;-</span> <span class="fu">g</span><span class="op">(</span><span class="va">X</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">param</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gtOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="hier.gt.simulation.html">hier.gt.simulation</a></span><span class="op">(</span><span class="va">N</span>,<span class="va">pReg</span>,<span class="va">S</span>,<span class="va">psz</span>,<span class="va">Se</span>,<span class="va">Sp</span>,<span class="va">assayID</span><span class="op">)</span><span class="op">$</span><span class="va">gtData</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fitting the model:</span></span></span>
<span class="r-in"><span><span class="va">param0</span> <span class="op">&lt;-</span> <span class="va">param</span> <span class="op">+</span> <span class="fl">0.2</span> </span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">glm.gt</span><span class="op">(</span>beta0<span class="op">=</span><span class="va">param0</span>,gtData<span class="op">=</span><span class="va">gtOut</span>,</span></span>
<span class="r-in"><span>              X<span class="op">=</span><span class="va">X</span>,g<span class="op">=</span><span class="va">g</span>,dg<span class="op">=</span><span class="cn">NULL</span>,d2g<span class="op">=</span><span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>              grdMethod<span class="op">=</span><span class="st">"central"</span>,covariance<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>              nburn<span class="op">=</span><span class="fl">2000</span>,ngit<span class="op">=</span><span class="fl">5000</span>,maxit<span class="op">=</span><span class="fl">200</span>,</span></span>
<span class="r-in"><span>              tol<span class="op">=</span><span class="fl">1e-03</span>,tracing<span class="op">=</span><span class="cn">TRUE</span>,conf.level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -2.812953 2.088358 0.7412474 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 -2.818211 2.080449 0.6673072 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -2.821267 2.083361 0.6594786 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -2.821076 2.083622 0.6569914 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 -2.820787 2.085547 0.6546649 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 -2.821301 2.08519 0.6555576 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $param</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -2.8213012  2.0851903  0.6555576</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $covariance</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]        [,2]        [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  0.04509651 -0.02526663 -0.03124407</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.02526663  0.04122643  0.00272804</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -0.03124407  0.00272804  0.05103122</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $iterUsed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $summary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std.Err 95%lower 95%upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      -2.821   0.212   -3.238   -2.405</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1    2.085   0.203    1.687    2.483</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2    0.656   0.226    0.213    1.098</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 5: Using pooled testing data.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pooled test outcomes:</span></span></span>
<span class="r-in"><span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>     </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Design matrix, X:</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">1.2</span>,<span class="fl">0.4</span>,<span class="fl">1.5</span>,<span class="fl">1.8</span>,<span class="fl">1.8</span>,<span class="fl">0.1</span>,<span class="fl">1.6</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span>,<span class="fl">1.8</span>,<span class="fl">0.2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">31</span>,<span class="fl">56</span>,<span class="fl">45</span>,<span class="fl">64</span>,<span class="fl">26</span>,<span class="fl">47</span>,<span class="fl">22</span>,<span class="fl">60</span>,<span class="fl">35</span>,<span class="fl">41</span>,<span class="fl">32</span>,<span class="fl">41</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pool sizes used:</span></span></span>
<span class="r-in"><span><span class="va">psz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pool-specific Se &amp; Sp:</span></span></span>
<span class="r-in"><span><span class="va">Se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.90</span>, <span class="fl">.90</span>, <span class="fl">.95</span>, <span class="fl">.95</span>, <span class="fl">.95</span>, <span class="fl">.92</span>, <span class="fl">.92</span>, <span class="fl">.92</span>, <span class="fl">.92</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.92</span>, <span class="fl">.92</span>, <span class="fl">.96</span>, <span class="fl">.96</span>, <span class="fl">.96</span>, <span class="fl">.90</span>, <span class="fl">.90</span>, <span class="fl">.90</span>, <span class="fl">.90</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assays used:</span></span></span>
<span class="r-in"><span><span class="va">Assay</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pool members:</span></span></span>
<span class="r-in"><span><span class="va">Memb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> </span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>,  <span class="fl">3</span>,  <span class="fl">4</span>,  <span class="fl">5</span>,  <span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">8</span>,  <span class="fl">9</span>, <span class="fl">10</span>, <span class="fl">11</span>, <span class="fl">12</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span>, <span class="op">-</span><span class="fl">9</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># The data-structure suited for 'gtData':</span></span></span>
<span class="r-in"><span><span class="va">gtOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">psz</span>, <span class="va">Se</span>, <span class="va">Sp</span>, <span class="va">Assay</span>, <span class="va">Memb</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fitting the model with logit link:</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> </span></span>
<span class="r-in"><span><span class="va">param0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>      </span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">glm.gt</span><span class="op">(</span>beta0<span class="op">=</span><span class="va">param0</span>,gtData<span class="op">=</span><span class="va">gtOut</span>,X<span class="op">=</span><span class="va">X</span>,                  </span></span>
<span class="r-in"><span>              g<span class="op">=</span><span class="va">g</span>,dg<span class="op">=</span><span class="cn">NULL</span>,d2g<span class="op">=</span><span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>              grdMethod<span class="op">=</span><span class="st">"central"</span>,covariance<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>              nburn<span class="op">=</span><span class="fl">2000</span>,ngit<span class="op">=</span><span class="fl">5000</span>,maxit<span class="op">=</span><span class="fl">200</span>,</span></span>
<span class="r-in"><span>              tol<span class="op">=</span><span class="fl">1e-03</span>,tracing<span class="op">=</span><span class="cn">TRUE</span>,conf.level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.06645849 -0.01045308 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.2268745 -0.02217112 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.3786805 -0.03266117 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.5094139 -0.04040876 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 0.6039655 -0.04584408 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 0.6362585 -0.04784675 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 0.6512803 -0.04894317 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8 0.6500133 -0.04873786 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9 0.6419188 -0.04855114 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 0.6453688 -0.04924704 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 0.6461254 -0.04919976 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $param</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  0.64612543 -0.04919976</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $covariance</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]         [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  1.83768710 -0.046161148</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.04616115  0.001741546</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $iterUsed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $summary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std.Err 95%lower 95%upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1    0.646   1.356   -2.011    3.303</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2   -0.049   0.042   -0.131    0.033</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Md S. Warasi.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

